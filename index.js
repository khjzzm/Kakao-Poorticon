const fetch = require('node-fetch');
const cheerio = require('cheerio');
const fs = require('fs');
const path = require('path');

// 주어진 HTML 문자열
const html = `
<ul class="list_emoticon"><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a5418f324a0b9c48f77dbce3a43bd11ce785" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a541f604e7b0e6900f9ac53a43965300eb9a" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a5419f5287469802eca457586a25a096fd31" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a5419f17e489affba0627eb1eb39695f93dd" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/20231219101911/img_send.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a54115b3f4e3c2033bfd702a321ec6eda72c" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/20231219101911/img_send.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a5414022de826f725e10df604bf1b9725cfd" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/20231219101911/img_send.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a5418b566dca82634c93f811198148a26065" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a54182f3bd8c9735553d03f6f982e10ebe70" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a541effd194bae87d73dd00522794070855d" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a541d0bbab1214a29e381afae56101ded106" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/20231219101911/img_send.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a5417f9f127ae3ca5dc7f0f6349aebcdb3c4" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a5417e6f47a71c79378b48860ead6a12bf11" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a541339e41ce89b663315d96faecd7cfd11b" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a54126397d82c8691bdabf557d1536959d9c" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a54141d1a2caccd0c566eab28b91e2e5d306" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a541616b58f7bf017e58d417ccb3283deeb3" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/20231219101911/img_send.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a541113e2bd2b7407c8202a97d2241a96625" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a541ac8e738cb631e72fdb9a96b36413984e" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a541ce9463e040a07a9462a54df43e1d73f1" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a541a88f7b2cbb72be0bdfff91ad65b168ab" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a54166d8fd08427c1f00d04db607cc4cdc8e" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a5416fb33a4b4cf43b6605fc7a1e262f0845" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a541b3a18fdf58bc66ec3f4b6084b7d0b570" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a541960f4ab09fe6e38bae8c63030c9b37f9" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a541fba8e3d30017c7399e19e508ee32200a" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a5419cbcbe2de7f4969efc79ab353e0c19e8" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a54171b950f0a05bd8dba8b11dbe535ebe4b" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a541ff1cf2d4e1bdc11c5e3dd410963d18c7" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/20231219101911/img_send.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a541c37d537a8f2c6f426591be6b8dc7b36a" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a541ba2da8249bd9ffef143efb890203e009" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a54100df9b2a481d32ec42ae698738782a76" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li><li class=""><a class="link_emoticon" href="#"><img src="https://item.kakaocdn.net/do/60d050a834bf03eaa1edfd93bea2a5412df16ed7012359e344d47930e49e9310" class="img_emoticon" alt="겨울 와플곰!"><div class="box_send"><img src="https://t1.kakaocdn.net/estoreweb/images/thumb_empty.png" class="img_send" alt="보내기"></div></a></li></ul>
`;

const $ = cheerio.load(html);

$('img.img_emoticon').each(async (index, element) => {
    const imgUrl = $(element).attr('src');
    const filename = path.basename(new URL(imgUrl).pathname);

    // 파일 확장자를 .png로 설정
    const outputFilename = filename+".png"
    
        try {
            const response = await fetch(imgUrl);
            if (!response.ok) {
                throw new Error(`Failed to fetch ${imgUrl}: ${response.statusText}`);
            }
    
            const dest = fs.createWriteStream(path.resolve(__dirname, outputFilename));
            response.body.pipe(dest);
    
            dest.on('finish', () => {
                console.log(`Successfully downloaded file: ${outputFilename}`);
            });
            dest.on('error', err => {
                console.error(`Error writing file: ${err.message}`);
            });
        } catch (error) {
            console.error(`Error downloading ${imgUrl}: ${error.message}`);
        }
    });
    